#!/bin/bash

# ==============================================
# –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ Spring Boot Proxy Server
# –ü—Ä–æ–≥—Ä–∞–º–º–∞ —É—á—ë—Ç–∞ —É—Å–ª—É–≥ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ –∫–ª—É–±–∞
# ==============================================

echo "=================================================="
echo "   üèãÔ∏è –°–ü–û–†–¢–ò–í–ù–´–ô –ö–õ–£–ë - –ü–†–û–ö–°–ò –°–ï–†–í–ï–†"
echo "   Spring Boot Reverse Proxy"
echo "=================================================="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Java
if ! command -v java &> /dev/null; then
    echo "‚ùå Java –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!"
    echo "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Java: brew install openjdk@21"
    exit 1
fi

JAVA_VERSION=$(java -version 2>&1 | head -n 1)
echo "‚úÖ Java: $JAVA_VERSION"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ Next.js –∑–∞–ø—É—â–µ–Ω
echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Next.js —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 3000..."

if curl -s http://localhost:3000 > /dev/null 2>&1; then
    echo "‚úÖ Next.js —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 3000"
else
    echo "‚ö†Ô∏è  Next.js —Å–µ—Ä–≤–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000"
    echo "   –ó–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ –∫–æ–º–∞–Ω–¥–æ–π: npm run dev"
    echo ""
    read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∑–∞–ø—É—Å–∫ –ø—Ä–æ–∫—Å–∏? (y/n): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

echo ""
echo "üöÄ –ó–∞–ø—É—Å–∫ Spring Boot –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞..."
echo "   –ü–æ—Ä—Ç: 8080"
echo "   –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫: http://localhost:3000"
echo "=================================================="
echo ""

# –ó–∞–ø—É—Å–∫ Spring Boot
./mvnw spring-boot:run

